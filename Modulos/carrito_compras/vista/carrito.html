<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Carrito de Compras</title>
    <style>
        table {
            border-collapse: collapse;
            width: 80%;
            margin: auto;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f2f2f2;
        }

        tfoot td {
            font-weight: bold;
        }
    </style>
</head>


<body>
    <h2 style="text-align:center;">Carrito de Compras</h2>
    <table id="tabla-carrito">
        <thead>
            <tr>
                <th>ID Carrito</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio</th>
                <th>Subtotal</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody id="carrito-body"></tbody>
    </table>

    <h3>Total: $<span id="total">0</span></h3>

    <script>
        // Función para cargar los productos del carrito
        async function cargarCarrito() {
            try {
                const response = await fetch("/view_carrito/data"); // endpoint de tu API
                const carrito = await response.json();

                let rows = "";
                carrito.forEach(c => {
                    rows += `
                    <tr>
                        <td>${c.Car_id}</td>
                        <td>${c.Product_name}</td>
                        <td>${c.Car_cantidad} UND</td>
                        <td>$${c.Product_price}</td>
                        <td>$${c.Car_subTotal}</td>
                        <td>
                            <button class="btn btn-danger" onclick="eliminarProducto(${c.Car_id})">Eliminar</button>
                        </td>
                    </tr>
                `;
                });

                // Pintar las filas en el tbody de la tabla
                document.getElementById("carrito-body").innerHTML = rows;

            } catch (error) {
                console.error("Error cargando productos:", error);
            }
        }

        // Función para eliminar un producto
        async function eliminarProducto(id) {
            if (!confirm("¿Seguro que deseas eliminar este producto?")) return;

            const res = await fetch(`/deleteCar/${Car_id}`, { method: "DELETE" });
            if (!res.ok) {
                alert("Error al eliminar el producto");
                return;
            }
            const data = await res.json();
            alert(data.message);

            cargarCarrito();
        }
        // Función para calcular y mostrar el total
        // function calcularTotal() {
        //     let total = 0;
        //     document.querySelectorAll("#carrito-body tr").forEach(row => {
        //         const subtotal = parseFloat(row.cells[4].innerText.replace('$', ''));
        //         total += subtotal;
        //     });
        //     document.getElementById("total").innerText = total.toFixed(2);
        // }

        // Cuando cargue la página, que se carguen los productos
        window.onload = cargarCarrito;
    </script>

    <button onclick="window.history.back()">⬅️ Regresar</button>


</body>

</html>